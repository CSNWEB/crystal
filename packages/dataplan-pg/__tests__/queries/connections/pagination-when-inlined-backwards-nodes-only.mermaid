graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:3px,color:#000
    classDef itemplan fill:#fff,stroke-width:6px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:6px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:6px,text-align:left


    %% define steps
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    Access18["Access[18∈0]<br />ᐸ3.pgSettingsᐳ"]:::plan
    Access19["Access[19∈0]<br />ᐸ3.withPgClientᐳ"]:::plan
    Object20["Object[20∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"]:::plan
    PgSelect17[["PgSelect[17∈0]<br />ᐸforumsᐳ"]]:::plan
    __Item21>"__Item[21∈1]<br />ᐸ17ᐳ"]:::itemplan
    PgSelectSingle22["PgSelectSingle[22∈1]<br />ᐸforumsᐳ"]:::plan
    PgClassExpression23["PgClassExpression[23∈1]<br />ᐸ__forums__.”name”ᐳ"]:::plan
    __InputStaticLeaf25["__InputStaticLeaf[25∈0]"]:::plan
    Connection38["Connection[38∈0]<br />ᐸ34ᐳ"]:::plan
    Access75["Access[75∈1]<br />ᐸ21.2ᐳ"]:::plan
    Lambda76["Lambda[76∈1]"]:::plan
    __Item40>"__Item[40∈2]<br />ᐸ76ᐳ"]:::itemplan
    PgSelectSingle41["PgSelectSingle[41∈2]<br />ᐸmessagesᐳ"]:::plan
    PgClassExpression42["PgClassExpression[42∈2]<br />ᐸ__messages__.”body”ᐳ"]:::plan
    Map72["Map[72∈2]<br />ᐸ41:{”0”:1,”1”:2}ᐳ"]:::plan
    List73["List[73∈2]<br />ᐸ72ᐳ"]:::plan
    First48["First[48∈2]"]:::plan
    PgSelectSingle49["PgSelectSingle[49∈2]<br />ᐸusersᐳ"]:::plan
    PgClassExpression50["PgClassExpression[50∈2]<br />ᐸ__users__.”username”ᐳ"]:::plan
    PgClassExpression51["PgClassExpression[51∈2]<br />ᐸ__users__....vatar_url”ᐳ"]:::plan
    PgPageInfo52["PgPageInfo[52∈0]"]:::plan
    Constant53["Constant[53∈0]"]:::plan
    Lambda55["Lambda[55∈1]<br />ᐸlistHasMoreᐳ"]:::plan
    First57["First[57∈1]"]:::plan
    PgSelectSingle58["PgSelectSingle[58∈1]<br />ᐸmessagesᐳ"]:::plan
    PgClassExpression60["PgClassExpression[60∈1]<br />ᐸ__messages__.”id”ᐳ"]:::plan
    List61["List[61∈1]<br />ᐸ60ᐳ"]:::plan
    PgCursor59["PgCursor[59∈1]"]:::plan
    Last63["Last[63∈1]"]:::plan
    PgSelectSingle64["PgSelectSingle[64∈1]<br />ᐸmessagesᐳ"]:::plan
    PgClassExpression66["PgClassExpression[66∈1]<br />ᐸ__messages__.”id”ᐳ"]:::plan
    List67["List[67∈1]<br />ᐸ66ᐳ"]:::plan
    PgCursor65["PgCursor[65∈1]"]:::plan
    Access74["Access[74∈1]<br />ᐸ21.1ᐳ"]:::plan
    First69["First[69∈1]"]:::plan
    PgSelectSingle70["PgSelectSingle[70∈1]<br />ᐸmessagesᐳ"]:::plan
    PgClassExpression71["PgClassExpression[71∈1]<br />ᐸcount(*)ᐳ"]:::plan

    %% plan dependencies
    __Value3 --> Access18
    __Value3 --> Access19
    Access18 & Access19 --> Object20
    Object20 --> PgSelect17
    PgSelect17 ==> __Item21
    __Item21 --> PgSelectSingle22
    PgSelectSingle22 --> PgClassExpression23
    __InputStaticLeaf25 --> Connection38
    __Item21 --> Access75
    Access75 --> Lambda76
    Lambda76 ==> __Item40
    __Item40 --> PgSelectSingle41
    PgSelectSingle41 --> PgClassExpression42
    PgSelectSingle41 --> Map72
    Map72 --> List73
    List73 --> First48
    First48 --> PgSelectSingle49
    PgSelectSingle49 --> PgClassExpression50
    PgSelectSingle49 --> PgClassExpression51
    Lambda76 --> Lambda55
    Lambda76 --> First57
    First57 --> PgSelectSingle58
    PgSelectSingle58 --> PgClassExpression60
    PgClassExpression60 --> List61
    List61 --> PgCursor59
    Lambda76 --> Last63
    Last63 --> PgSelectSingle64
    PgSelectSingle64 --> PgClassExpression66
    PgClassExpression66 --> List67
    List67 --> PgCursor65
    __Item21 --> Access74
    Access74 --> First69
    First69 --> PgSelectSingle70
    PgSelectSingle70 --> PgClassExpression71

    %% plan-to-path relationships

    subgraph "Buckets for queries/connections/pagination-when-inlined-backwards-nodes-only"
    Bucket0("Bucket 0<br />(root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value3,__Value5,PgSelect17,Access18,Access19,Object20,__InputStaticLeaf25,Connection38,PgPageInfo52,Constant53 bucket0
    Bucket1("Bucket 1<br />(listItem)<br />Deps: 38, 52, 53<br /><br />ROOT __Item{1}ᐸ17ᐳ[21]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item21,PgSelectSingle22,PgClassExpression23,Lambda55,First57,PgSelectSingle58,PgCursor59,PgClassExpression60,List61,Last63,PgSelectSingle64,PgCursor65,PgClassExpression66,List67,First69,PgSelectSingle70,PgClassExpression71,Access74,Access75,Lambda76 bucket1
    Bucket2("Bucket 2<br />(listItem)<br />ROOT __Item{2}ᐸ76ᐳ[40]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item40,PgSelectSingle41,PgClassExpression42,First48,PgSelectSingle49,PgClassExpression50,PgClassExpression51,Map72,List73 bucket2
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    end
