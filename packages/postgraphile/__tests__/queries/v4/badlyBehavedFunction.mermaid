graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:3px,color:#000
    classDef itemplan fill:#fff,stroke-width:6px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:6px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:6px,text-align:left


    %% define plans
    __Value0["__Value[0∈0]"]:::plan
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    Access28["Access[28∈0]<br />ᐸ3.pgSettingsᐳ"]:::plan
    Access29["Access[29∈0]<br />ᐸ3.withPgClientᐳ"]:::plan
    Object30["Object[30∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"]:::plan
    Connection31["Connection[31∈0]<br />ᐸ27ᐳ"]:::plan
    PgSelect32[["PgSelect[32∈0]<br />ᐸbadly_behaved_functionᐳ"]]:::plan
    __ListTransform33["__ListTransform[33∈0]<br />ᐸeach:32ᐳ"]:::plan
    __Item34>"__Item[34∈1]<br />ᐸ32ᐳ"]:::itemplan
    PgSelectSingle35["PgSelectSingle[35∈1]<br />ᐸbadly_behaved_functionᐳ"]:::plan
    __Item36>"__Item[36∈2]<br />ᐸ33ᐳ"]:::itemplan
    PgSelectSingle37["PgSelectSingle[37∈2]<br />ᐸbadly_behaved_functionᐳ"]:::plan
    Constant38["Constant[38∈0]"]:::plan
    PgClassExpression39["PgClassExpression[39∈2]<br />ᐸ__badly_be...ion__.”id”ᐳ"]:::plan
    List40["List[40∈2]<br />ᐸ38,39ᐳ"]:::plan
    Lambda41["Lambda[41∈2]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression44["PgClassExpression[44∈2]<br />ᐸ”c”.”perso...unction__)ᐳ"]:::plan
    __ListTransform46["__ListTransform[46∈0]<br />ᐸeach:45ᐳ"]:::plan
    __Item47>"__Item[47∈3]<br />ᐸ32ᐳ"]:::itemplan
    PgSelectSingle48["PgSelectSingle[48∈3]<br />ᐸbadly_behaved_functionᐳ"]:::plan
    __Item49>"__Item[49∈4]<br />ᐸ46ᐳ"]:::itemplan
    PgSelectSingle50["PgSelectSingle[50∈4]<br />ᐸbadly_behaved_functionᐳ"]:::plan
    Edge51["Edge[51∈4]"]:::plan
    PgClassExpression53["PgClassExpression[53∈4]<br />ᐸrow_number...tion by 1)ᐳ"]:::plan
    List54["List[54∈4]<br />ᐸ53ᐳ"]:::plan
    PgCursor52["PgCursor[52∈4]"]:::plan
    Constant55["Constant[55∈0]"]:::plan
    PgClassExpression56["PgClassExpression[56∈4]<br />ᐸ__badly_be...ion__.”id”ᐳ"]:::plan
    List57["List[57∈4]<br />ᐸ55,56ᐳ"]:::plan
    Lambda58["Lambda[58∈4]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression61["PgClassExpression[61∈4]<br />ᐸ”c”.”perso...unction__)ᐳ"]:::plan

    %% plan dependencies
    __Value3 --> Access28
    __Value3 --> Access29
    Access28 & Access29 --> Object30
    Object30 & Connection31 --> PgSelect32
    PgSelect32 --> __ListTransform33
    PgSelectSingle35 -.-> __ListTransform33
    PgSelect32 -.-> __Item34
    __Item34 --> PgSelectSingle35
    __ListTransform33 ==> __Item36
    __Item36 --> PgSelectSingle37
    PgSelectSingle37 --> PgClassExpression39
    Constant38 & PgClassExpression39 --> List40
    List40 --> Lambda41
    PgSelectSingle37 --> PgClassExpression44
    PgSelect32 --> __ListTransform46
    PgSelectSingle48 -.-> __ListTransform46
    PgSelect32 -.-> __Item47
    __Item47 --> PgSelectSingle48
    __ListTransform46 ==> __Item49
    __Item49 --> PgSelectSingle50
    PgSelectSingle50 --> Edge51
    PgSelectSingle50 --> PgClassExpression53
    PgClassExpression53 --> List54
    List54 --> PgCursor52
    PgSelectSingle50 --> PgClassExpression56
    Constant55 & PgClassExpression56 --> List57
    List57 --> Lambda58
    PgSelectSingle50 --> PgClassExpression61

    %% plan-to-path relationships
    P0["~"]
    __Value0 -.-> P0
    P31["ᐳbadlyBehavedFunction"]
    Connection31 -.-> P31
    P33["ᐳb…nᐳnodes"]
    __ListTransform33 -.-> P33
    P35["ᐳb…nᐳnodes@33[]"]
    PgSelectSingle35 -.-> P35
    P37["ᐳb…nᐳnodes[]"]
    PgSelectSingle37 -.-> P37
    P39["ᐳb…nᐳn…]ᐳid"]
    PgClassExpression39 -.-> P39
    P41["ᐳb…nᐳn…]ᐳnodeId"]
    Lambda41 -.-> P41
    P44["ᐳb…nᐳn…]ᐳfirstName"]
    PgClassExpression44 -.-> P44
    P46["ᐳb…nᐳedges"]
    __ListTransform46 -.-> P46
    P48["ᐳb…nᐳedges@46[]"]
    PgSelectSingle48 -.-> P48
    P50["ᐳb…nᐳe…]ᐳnode"]
    PgSelectSingle50 -.-> P50
    P51["ᐳb…nᐳedges[]"]
    Edge51 -.-> P51
    P52["ᐳb…nᐳe…]ᐳcursor"]
    PgCursor52 -.-> P52
    P56["ᐳb…nᐳe…]ᐳnodeᐳid"]
    PgClassExpression56 -.-> P56
    P58["ᐳb…nᐳe…]ᐳnodeᐳnodeId"]
    Lambda58 -.-> P58
    P61["ᐳb…nᐳe…]ᐳnodeᐳfirstName"]
    PgClassExpression61 -.-> P61

    subgraph "Buckets for queries/v4/badlyBehavedFunction"
    Bucket0("Bucket 0 (root)<br />~<br />⠀ROOT ᐸ-O- 0<br />⠀⠀badlyBehavedFunction ᐸ-O- 31<br />⠀⠀⠀badlyBehavedFunction.nodes ᐸ-A- 33<br />⠀⠀⠀badlyBehavedFunction.edges ᐸ-A- 46"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value3,Access28,Access29,Object30,Connection31,PgSelect32,__ListTransform33,Constant38,__ListTransform46,Constant55 bucket0
    Bucket1("Bucket 1 (item34)<br />Deps: 32"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item34,PgSelectSingle35 bucket1
    Bucket2("Bucket 2 (item36)<br />Deps: 33, 38<br />~ᐳQuery.badlyBehavedFunctionᐳPeopleConnection.nodes[]<br />⠀ROOT ᐸ-O- 37<br />⠀⠀id ᐸ-L- 39<br />⠀⠀nodeId ᐸ-L- 41<br />⠀⠀firstName ᐸ-L- 44"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item36,PgSelectSingle37,PgClassExpression39,List40,Lambda41,PgClassExpression44 bucket2
    Bucket3("Bucket 3 (item47)<br />Deps: 32"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item47,PgSelectSingle48 bucket3
    Bucket4("Bucket 4 (item49)<br />Deps: 46, 55<br />~ᐳQuery.badlyBehavedFunctionᐳPeopleConnection.edges[]<br />⠀ROOT ᐸ-O- 51<br />⠀⠀node ᐸ-O- 50<br />⠀⠀⠀node.id ᐸ-L- 56<br />⠀⠀⠀node.nodeId ᐸ-L- 58<br />⠀⠀⠀node.firstName ᐸ-L- 61<br />⠀⠀cursor ᐸ-L- 52"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item49,PgSelectSingle50,Edge51,PgCursor52,PgClassExpression53,List54,PgClassExpression56,List57,Lambda58,PgClassExpression61 bucket4
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4
    end
