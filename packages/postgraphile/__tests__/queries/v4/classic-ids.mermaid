graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:3px,color:#000
    classDef itemplan fill:#fff,stroke-width:6px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:6px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:6px,text-align:left


    %% define plans
    __Value0["__Value[0∈0]"]:::plan
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __InputStaticLeaf13["__InputStaticLeaf[13∈0]"]:::plan
    Access22["Access[22∈0]<br />ᐸ3.pgSettingsᐳ"]:::plan
    Access23["Access[23∈0]<br />ᐸ3.withPgClientᐳ"]:::plan
    Object24["Object[24∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"]:::plan
    PgSelect21[["PgSelect[21∈0]<br />ᐸpostᐳ"]]:::plan
    Constant56["Constant[56∈0]"]:::plan
    __Item27>"__Item[27∈1]<br />ᐸ21ᐳ"]:::itemplan
    PgSelectSingle28["PgSelectSingle[28∈1]<br />ᐸpostᐳ"]:::plan
    Constant29["Constant[29∈0]"]:::plan
    PgClassExpression30["PgClassExpression[30∈1]<br />ᐸ__post__.”id”ᐳ"]:::plan
    List31["List[31∈1]<br />ᐸ29,30ᐳ"]:::plan
    Lambda32["Lambda[32∈1]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression34["PgClassExpression[34∈1]<br />ᐸ__post__.”headline”ᐳ"]:::plan
    __InputStaticLeaf43["__InputStaticLeaf[43∈0]"]:::plan
    PgSelect47[["PgSelect[47∈0]<br />ᐸedgeCaseᐳ"]]:::plan
    Constant57["Constant[57∈0]"]:::plan
    __Item53>"__Item[53∈2]<br />ᐸ47ᐳ"]:::itemplan
    PgSelectSingle54["PgSelectSingle[54∈2]<br />ᐸedgeCaseᐳ"]:::plan
    PgClassExpression55["PgClassExpression[55∈2]<br />ᐸ__edge_case__.”row_id”ᐳ"]:::plan

    %% plan dependencies
    __Value3 --> Access22
    __Value3 --> Access23
    Access22 & Access23 --> Object24
    Object24 & __InputStaticLeaf13 --> PgSelect21
    PgSelect21 ==> __Item27
    __Item27 --> PgSelectSingle28
    PgSelectSingle28 --> PgClassExpression30
    Constant29 & PgClassExpression30 --> List31
    List31 --> Lambda32
    PgSelectSingle28 --> PgClassExpression34
    Object24 & __InputStaticLeaf43 --> PgSelect47
    PgSelect47 ==> __Item53
    __Item53 --> PgSelectSingle54
    PgSelectSingle54 --> PgClassExpression55

    %% plan-to-path relationships
    P0["~"]
    __Value0 -.-> P0
    P21["ᐳa…sᐳnodes"]
    PgSelect21 -.-> P21
    P28["ᐳa…sᐳnodes[]"]
    PgSelectSingle28 -.-> P28
    P30["ᐳa…sᐳn…]ᐳrowId"]
    PgClassExpression30 -.-> P30
    P32["ᐳa…sᐳn…]ᐳid"]
    Lambda32 -.-> P32
    P34["ᐳa…sᐳn…]ᐳheadline"]
    PgClassExpression34 -.-> P34
    P47["ᐳa…sᐳnodes"]
    PgSelect47 -.-> P47
    P54["ᐳa…sᐳnodes[]"]
    PgSelectSingle54 -.-> P54
    P55["ᐳa…sᐳn…]ᐳrowId"]
    PgClassExpression55 -.-> P55
    P56["ᐳallPosts"]
    Constant56 -.-> P56
    P57["ᐳallEdgeCases"]
    Constant57 -.-> P57

    subgraph "Buckets for queries/v4/classic-ids"
    Bucket0("Bucket 0 (root)<br />~<br />⠀ROOT ᐸ-O- 0<br />⠀⠀allPosts ᐸ-O- 56<br />⠀⠀⠀allPosts.nodes ᐸ-A- 21<br />⠀⠀allEdgeCases ᐸ-O- 57<br />⠀⠀⠀allEdgeCases.nodes ᐸ-A- 47"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value3,__InputStaticLeaf13,PgSelect21,Access22,Access23,Object24,Constant29,__InputStaticLeaf43,PgSelect47,Constant56,Constant57 bucket0
    Bucket1("Bucket 1 (item27)<br />Deps: 21, 29<br />~ᐳQuery.allPostsᐳPostConnection.nodes[]<br />⠀ROOT ᐸ-O- 28<br />⠀⠀rowId ᐸ-L- 30<br />⠀⠀id ᐸ-L- 32<br />⠀⠀headline ᐸ-L- 34"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item27,PgSelectSingle28,PgClassExpression30,List31,Lambda32,PgClassExpression34 bucket1
    Bucket2("Bucket 2 (item53)<br />Deps: 47<br />~ᐳQuery.allEdgeCasesᐳEdgeCaseConnection.nodes[]<br />⠀ROOT ᐸ-O- 54<br />⠀⠀rowId ᐸ-L- 55"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item53,PgSelectSingle54,PgClassExpression55 bucket2
    Bucket0 --> Bucket1 & Bucket2
    end
