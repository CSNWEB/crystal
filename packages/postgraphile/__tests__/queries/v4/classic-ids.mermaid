graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:3px,color:#000
    classDef itemplan fill:#fff,stroke-width:6px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:6px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:6px,text-align:left


    %% define plans
    __Value0["__Value[0∈0]"]:::plan
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __InputStaticLeaf7["__InputStaticLeaf[7∈0]"]:::plan
    __InputStaticLeaf8["__InputStaticLeaf[8∈0]"]:::plan
    __InputStaticLeaf9["__InputStaticLeaf[9∈0]"]:::plan
    __InputStaticLeaf13["__InputStaticLeaf[13∈0]"]:::plan
    Access22["Access[22∈0]<br />ᐸ3.pgSettingsᐳ"]:::plan
    Access23["Access[23∈0]<br />ᐸ3.withPgClientᐳ"]:::plan
    Object24["Object[24∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"]:::plan
    Connection25["Connection[25∈0]<br />ᐸ21ᐳ"]:::plan
    PgSelect26[["PgSelect[26∈0]<br />ᐸpostᐳ"]]:::plan
    __Item27>"__Item[27∈1]<br />ᐸ26ᐳ"]:::itemplan
    PgSelectSingle28["PgSelectSingle[28∈1]<br />ᐸpostᐳ"]:::plan
    Constant29["Constant[29∈0]"]:::plan
    PgClassExpression30["PgClassExpression[30∈1]<br />ᐸ__post__.”id”ᐳ"]:::plan
    List31["List[31∈1]<br />ᐸ29,30ᐳ"]:::plan
    Lambda32["Lambda[32∈1]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression34["PgClassExpression[34∈1]<br />ᐸ__post__.”headline”ᐳ"]:::plan
    __InputStaticLeaf35["__InputStaticLeaf[35∈0]"]:::plan
    __InputStaticLeaf36["__InputStaticLeaf[36∈0]"]:::plan
    __InputStaticLeaf37["__InputStaticLeaf[37∈0]"]:::plan
    __InputStaticLeaf43["__InputStaticLeaf[43∈0]"]:::plan
    Connection51["Connection[51∈0]<br />ᐸ47ᐳ"]:::plan
    PgSelect52[["PgSelect[52∈0]<br />ᐸedgeCaseᐳ"]]:::plan
    __Item53>"__Item[53∈2]<br />ᐸ52ᐳ"]:::itemplan
    PgSelectSingle54["PgSelectSingle[54∈2]<br />ᐸedgeCaseᐳ"]:::plan
    PgClassExpression55["PgClassExpression[55∈2]<br />ᐸ__edge_case__.”row_id”ᐳ"]:::plan

    %% plan dependencies
    __Value3 --> Access22
    __Value3 --> Access23
    Access22 & Access23 --> Object24
    __InputStaticLeaf7 & __InputStaticLeaf8 & __InputStaticLeaf9 --> Connection25
    Object24 & __InputStaticLeaf13 & Connection25 --> PgSelect26
    PgSelect26 ==> __Item27
    __Item27 --> PgSelectSingle28
    PgSelectSingle28 --> PgClassExpression30
    Constant29 & PgClassExpression30 --> List31
    List31 --> Lambda32
    PgSelectSingle28 --> PgClassExpression34
    __InputStaticLeaf35 & __InputStaticLeaf36 & __InputStaticLeaf37 --> Connection51
    Object24 & __InputStaticLeaf43 & Connection51 --> PgSelect52
    PgSelect52 ==> __Item53
    __Item53 --> PgSelectSingle54
    PgSelectSingle54 --> PgClassExpression55

    %% plan-to-path relationships
    P0["~"]
    __Value0 -.-> P0
    P25["ᐳallPosts"]
    Connection25 -.-> P25
    P26["ᐳa…sᐳnodes"]
    PgSelect26 -.-> P26
    P28["ᐳa…sᐳnodes[]"]
    PgSelectSingle28 -.-> P28
    P30["ᐳa…sᐳn…]ᐳrowId"]
    PgClassExpression30 -.-> P30
    P32["ᐳa…sᐳn…]ᐳid"]
    Lambda32 -.-> P32
    P34["ᐳa…sᐳn…]ᐳheadline"]
    PgClassExpression34 -.-> P34
    P51["ᐳallEdgeCases"]
    Connection51 -.-> P51
    P52["ᐳa…sᐳnodes"]
    PgSelect52 -.-> P52
    P54["ᐳa…sᐳnodes[]"]
    PgSelectSingle54 -.-> P54
    P55["ᐳa…sᐳn…]ᐳrowId"]
    PgClassExpression55 -.-> P55

    subgraph "Buckets for queries/v4/classic-ids"
    Bucket0("Bucket 0 (root)<br />~<br />⠀ROOT ᐸ-O- 0<br />⠀⠀allPosts ᐸ-O- 25<br />⠀⠀⠀allPosts.nodes ᐸ-A- 26<br />⠀⠀allEdgeCases ᐸ-O- 51<br />⠀⠀⠀allEdgeCases.nodes ᐸ-A- 52"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value3,__InputStaticLeaf7,__InputStaticLeaf8,__InputStaticLeaf9,__InputStaticLeaf13,Access22,Access23,Object24,Connection25,PgSelect26,Constant29,__InputStaticLeaf35,__InputStaticLeaf36,__InputStaticLeaf37,__InputStaticLeaf43,Connection51,PgSelect52 bucket0
    Bucket1("Bucket 1 (item27)<br />Deps: 26, 29<br />~ᐳQuery.allPostsᐳPostsConnection.nodes[]<br />⠀ROOT ᐸ-O- 28<br />⠀⠀rowId ᐸ-L- 30<br />⠀⠀id ᐸ-L- 32<br />⠀⠀headline ᐸ-L- 34"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item27,PgSelectSingle28,PgClassExpression30,List31,Lambda32,PgClassExpression34 bucket1
    Bucket2("Bucket 2 (item53)<br />Deps: 52<br />~ᐳQuery.allEdgeCasesᐳEdgeCasesConnection.nodes[]<br />⠀ROOT ᐸ-O- 54<br />⠀⠀rowId ᐸ-L- 55"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item53,PgSelectSingle54,PgClassExpression55 bucket2
    Bucket0 --> Bucket1 & Bucket2
    end
