graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:3px,color:#000
    classDef itemplan fill:#fff,stroke-width:6px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:6px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:6px,text-align:left


    %% define plans
    __Value0["__Value[0∈0]"]:::plan
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __InputStaticLeaf7["__InputStaticLeaf[7∈0]"]:::plan
    __InputStaticLeaf8["__InputStaticLeaf[8∈0]"]:::plan
    __InputStaticLeaf9["__InputStaticLeaf[9∈0]"]:::plan
    Access75["Access[75∈0]<br />ᐸ3.pgSettingsᐳ"]:::plan
    Access76["Access[76∈0]<br />ᐸ3.withPgClientᐳ"]:::plan
    Object77["Object[77∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"]:::plan
    Connection25["Connection[25∈0]<br />ᐸ21ᐳ"]:::plan
    PgSelect26[["PgSelect[26∈0]<br />ᐸpostᐳ"]]:::plan
    __Item27>"__Item[27∈1]<br />ᐸ26ᐳ"]:::itemplan
    PgSelectSingle28["PgSelectSingle[28∈1]<br />ᐸpostᐳ"]:::plan
    PgClassExpression30["PgClassExpression[30∈1]<br />ᐸ__post__.”id”ᐳ"]:::plan
    List31["List[31∈1]<br />ᐸ30ᐳ"]:::plan
    PgCursor29["PgCursor[29∈1]"]:::plan
    PgClassExpression33["PgClassExpression[33∈1]<br />ᐸ__post__.”headline”ᐳ"]:::plan
    PgClassExpression37["PgClassExpression[37∈1]<br />ᐸ”a”.”post_...(__post__)ᐳ"]:::plan
    Map103["Map[103∈1]<br />ᐸ28:{”0”:3,”1”:4,”2”:5,”3”:6,”4”:7,”5”:8,”6”:9,”7”:10,”8”:11,”9”:12,”10”:13}ᐳ"]:::plan
    PgSelectSingle44["PgSelectSingle[44∈1]<br />ᐸpersonᐳ"]:::plan
    PgClassExpression45["PgClassExpression[45∈1]<br />ᐸ__person__.”id”ᐳ"]:::plan
    PgClassExpression46["PgClassExpression[46∈1]<br />ᐸ__person__...full_name”ᐳ"]:::plan
    PgClassExpression48["PgClassExpression[48∈1]<br />ᐸ”c”.”perso..._person__)ᐳ"]:::plan
    Map99["Map[99∈1]<br />ᐸ44:{”0”:2,”1”:3,”2”:4,”3”:5,”4”:6,”5”:7}ᐳ"]:::plan
    PgSelectSingle55["PgSelectSingle[55∈1]<br />ᐸperson_first_postᐳ"]:::plan
    PgClassExpression56["PgClassExpression[56∈1]<br />ᐸ__person_f...ost__.”id”ᐳ"]:::plan
    PgClassExpression57["PgClassExpression[57∈1]<br />ᐸ__person_f...”headline”ᐳ"]:::plan
    PgClassExpression61["PgClassExpression[61∈1]<br />ᐸ”a”.”post_...st_post__)ᐳ"]:::plan
    Map97["Map[97∈1]<br />ᐸ55:{”0”:3,”1”:4,”2”:5}ᐳ"]:::plan
    PgSelectSingle68["PgSelectSingle[68∈1]<br />ᐸpersonᐳ"]:::plan
    PgClassExpression69["PgClassExpression[69∈1]<br />ᐸ__person__.”id”ᐳ"]:::plan
    PgClassExpression70["PgClassExpression[70∈1]<br />ᐸ__person__...full_name”ᐳ"]:::plan
    PgClassExpression72["PgClassExpression[72∈1]<br />ᐸ”c”.”perso..._person__)ᐳ"]:::plan
    Connection78["Connection[78∈0]<br />ᐸ74ᐳ"]:::plan
    Access101["Access[101∈1]<br />ᐸ103.8ᐳ"]:::plan
    __Item80>"__Item[80∈2]<br />ᐸ101ᐳ"]:::itemplan
    PgSelectSingle81["PgSelectSingle[81∈2]<br />ᐸperson_friendsᐳ"]:::plan
    PgClassExpression82["PgClassExpression[82∈2]<br />ᐸ__person_friends__.”id”ᐳ"]:::plan
    PgClassExpression83["PgClassExpression[83∈2]<br />ᐸ__person_f...full_name”ᐳ"]:::plan
    PgClassExpression85["PgClassExpression[85∈2]<br />ᐸ”c”.”perso...friends__)ᐳ"]:::plan
    Access102["Access[102∈1]<br />ᐸ103.9ᐳ"]:::plan
    First87["First[87∈1]"]:::plan
    PgSelectSingle88["PgSelectSingle[88∈1]<br />ᐸperson_friendsᐳ"]:::plan
    PgClassExpression89["PgClassExpression[89∈1]<br />ᐸcount(*)ᐳ"]:::plan
    PgPageInfo90["PgPageInfo[90∈0]"]:::plan
    First92["First[92∈1]"]:::plan
    PgSelectSingle93["PgSelectSingle[93∈1]<br />ᐸperson_friendsᐳ"]:::plan
    PgClassExpression95["PgClassExpression[95∈1]<br />ᐸrow_number...tion by 1)ᐳ"]:::plan
    List96["List[96∈1]<br />ᐸ95ᐳ"]:::plan
    PgCursor94["PgCursor[94∈1]"]:::plan

    %% plan dependencies
    __Value3 --> Access75
    __Value3 --> Access76
    Access75 & Access76 --> Object77
    __InputStaticLeaf7 & __InputStaticLeaf8 & __InputStaticLeaf9 --> Connection25
    Object77 & Connection25 --> PgSelect26
    PgSelect26 ==> __Item27
    __Item27 --> PgSelectSingle28
    PgSelectSingle28 --> PgClassExpression30
    PgClassExpression30 --> List31
    List31 --> PgCursor29
    PgSelectSingle28 --> PgClassExpression33
    PgSelectSingle28 --> PgClassExpression37
    PgSelectSingle28 --> Map103
    Map103 --> PgSelectSingle44
    PgSelectSingle44 --> PgClassExpression45
    PgSelectSingle44 --> PgClassExpression46
    PgSelectSingle44 --> PgClassExpression48
    PgSelectSingle44 --> Map99
    Map99 --> PgSelectSingle55
    PgSelectSingle55 --> PgClassExpression56
    PgSelectSingle55 --> PgClassExpression57
    PgSelectSingle55 --> PgClassExpression61
    PgSelectSingle55 --> Map97
    Map97 --> PgSelectSingle68
    PgSelectSingle68 --> PgClassExpression69
    PgSelectSingle68 --> PgClassExpression70
    PgSelectSingle68 --> PgClassExpression72
    Map103 --> Access101
    Access101 ==> __Item80
    __Item80 --> PgSelectSingle81
    PgSelectSingle81 --> PgClassExpression82
    PgSelectSingle81 --> PgClassExpression83
    PgSelectSingle81 --> PgClassExpression85
    Map103 --> Access102
    Access102 --> First87
    First87 --> PgSelectSingle88
    PgSelectSingle88 --> PgClassExpression89
    Access101 --> First92
    First92 --> PgSelectSingle93
    PgSelectSingle93 --> PgClassExpression95
    PgClassExpression95 --> List96
    List96 --> PgCursor94

    %% plan-to-path relationships
    P0["~"]
    __Value0 -.-> P0
    P25["ᐳallPosts"]
    Connection25 -.-> P25
    P26["ᐳa…sᐳedges"]
    PgSelect26 -.-> P26
    P28["ᐳa…sᐳedges[]<br />ᐳa…sᐳe…]ᐳnode"]
    PgSelectSingle28 -.-> P28
    P29["ᐳa…sᐳe…]ᐳcursor"]
    PgCursor29 -.-> P29
    P30["ᐳa…sᐳe…]ᐳnodeᐳid"]
    PgClassExpression30 -.-> P30
    P33["ᐳa…sᐳe…]ᐳnodeᐳheadline"]
    PgClassExpression33 -.-> P33
    P37["ᐳa…sᐳe…]ᐳnodeᐳheadlineTrimmed"]
    PgClassExpression37 -.-> P37
    P44["ᐳa…sᐳe…]ᐳnodeᐳauthor"]
    PgSelectSingle44 -.-> P44
    P45["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳid"]
    PgClassExpression45 -.-> P45
    P46["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳname"]
    PgClassExpression46 -.-> P46
    P48["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳfirstName"]
    PgClassExpression48 -.-> P48
    P55["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳfirstPost"]
    PgSelectSingle55 -.-> P55
    P56["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…tᐳid"]
    PgClassExpression56 -.-> P56
    P57["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…tᐳheadline"]
    PgClassExpression57 -.-> P57
    P61["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…tᐳheadlineTrimmed"]
    PgClassExpression61 -.-> P61
    P68["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…tᐳauthor"]
    PgSelectSingle68 -.-> P68
    P69["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…tᐳa…rᐳid"]
    PgClassExpression69 -.-> P69
    P70["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…tᐳa…rᐳname"]
    PgClassExpression70 -.-> P70
    P72["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…tᐳa…rᐳfirstName"]
    PgClassExpression72 -.-> P72
    P78["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳfriends"]
    Connection78 -.-> P78
    P81["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…sᐳnodes[]"]
    PgSelectSingle81 -.-> P81
    P82["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…sᐳn…]ᐳid"]
    PgClassExpression82 -.-> P82
    P83["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…sᐳn…]ᐳname"]
    PgClassExpression83 -.-> P83
    P85["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…sᐳn…]ᐳfirstName"]
    PgClassExpression85 -.-> P85
    P89["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…sᐳtotalCount"]
    PgClassExpression89 -.-> P89
    P90["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…sᐳpageInfo"]
    PgPageInfo90 -.-> P90
    P94["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…sᐳp…oᐳstartCursor"]
    PgCursor94 -.-> P94
    P101["ᐳa…sᐳe…]ᐳnodeᐳa…rᐳf…sᐳnodes"]
    Access101 -.-> P101

    subgraph "Buckets for queries/v4/posts"
    Bucket0("Bucket 0 (root)<br />~<br />⠀ROOT ᐸ-O- 0<br />⠀⠀allPosts ᐸ-O- 25<br />⠀⠀⠀allPosts.edges ᐸ-A- 26"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value3,__InputStaticLeaf7,__InputStaticLeaf8,__InputStaticLeaf9,Connection25,PgSelect26,Access75,Access76,Object77,Connection78,PgPageInfo90 bucket0
    Bucket1("Bucket 1 (item27)<br />Deps: 26, 78, 90<br />~ᐳQuery.allPostsᐳPostsConnection.edges[]<br />⠀ROOT ᐸ-O- 28<br />⠀⠀node ᐸ-O- 28<br />⠀⠀⠀node.id ᐸ-L- 30<br />⠀⠀⠀node.headline ᐸ-L- 33<br />⠀⠀⠀node.headlineTrimmed ᐸ-L- 37<br />⠀⠀⠀node.author ᐸ-O- 44<br />⠀⠀⠀⠀node.author.id ᐸ-L- 45<br />⠀⠀⠀⠀node.author.name ᐸ-L- 46<br />⠀⠀⠀⠀node.author.firstName ᐸ-L- 48<br />⠀⠀⠀⠀node.author.firstPost ᐸ-O- 55<br />⠀⠀⠀⠀⠀node.author.firstPost.id ᐸ-L- 56<br />⠀⠀⠀⠀⠀node.author.firstPost.headline ᐸ-L- 57<br />⠀⠀⠀⠀⠀node.author.firstPost.headlineTrimmed ᐸ-L- 61<br />⠀⠀⠀⠀⠀node.author.firstPost.author ᐸ-O- 68<br />⠀⠀⠀⠀⠀⠀node.author.firstPost.author.id ᐸ-L- 69<br />⠀⠀⠀⠀⠀⠀node.author.firstPost.author.name ᐸ-L- 70<br />⠀⠀⠀⠀⠀⠀node.author.firstPost.author.firstName ᐸ-L- 72<br />⠀⠀⠀⠀node.author.friends ᐸ-O- 78<br />⠀⠀⠀⠀⠀node.author.friends.totalCount ᐸ-L- 89<br />⠀⠀⠀⠀⠀node.author.friends.pageInfo ᐸ-O- 90<br />⠀⠀⠀⠀⠀⠀node.author.friends.pageInfo.startCursor ᐸ-L- 94<br />⠀⠀⠀⠀⠀node.author.friends.nodes ᐸ-A- 101<br />⠀⠀cursor ᐸ-L- 29"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item27,PgSelectSingle28,PgCursor29,PgClassExpression30,List31,PgClassExpression33,PgClassExpression37,PgSelectSingle44,PgClassExpression45,PgClassExpression46,PgClassExpression48,PgSelectSingle55,PgClassExpression56,PgClassExpression57,PgClassExpression61,PgSelectSingle68,PgClassExpression69,PgClassExpression70,PgClassExpression72,First87,PgSelectSingle88,PgClassExpression89,First92,PgSelectSingle93,PgCursor94,PgClassExpression95,List96,Map97,Map99,Access101,Access102,Map103 bucket1
    Bucket2("Bucket 2 (item80)<br />Deps: 101<br />~ᐳQuery.allPostsᐳPostsConnection.edges[]ᐳPostEdge.nodeᐳPost.authorᐳPerson.friendsᐳPeopleConnection.nodes[]<br />⠀ROOT ᐸ-O- 81<br />⠀⠀id ᐸ-L- 82<br />⠀⠀name ᐸ-L- 83<br />⠀⠀firstName ᐸ-L- 85"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item80,PgSelectSingle81,PgClassExpression82,PgClassExpression83,PgClassExpression85 bucket2
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    end
